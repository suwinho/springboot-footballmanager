<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Tactics Manager - FIFA Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .zone {
        min-height: 550px;
        transition: all 0.3s ease;
      }
      .drag-over {
        background: rgba(34, 197, 94, 0.15);
        border: 2px dashed #22c55e;
        transform: scale(1.005);
      }
      .player-card {
        cursor: grab;
        transition: all 0.2s ease;
      }
      .player-card:active {
        cursor: grabbing;
      }
      .dragging {
        opacity: 0.4;
        transform: scale(0.9);
      }
    </style>
  </head>
  <body class="bg-slate-950 text-slate-100 font-sans">
    <div class="container mx-auto p-6 max-w-6xl">
      <header
        class="flex justify-between items-center mb-10 border-b border-slate-800 pb-6"
      >
        <div>
          <h1
            class="text-4xl font-black uppercase italic tracking-tighter"
            th:text="${team.name}"
          >
            TEAM
          </h1>
          <p class="text-slate-500 text-sm font-bold tracking-widest uppercase">
            ZarzƒÖdzanie TaktykƒÖ
          </p>
        </div>

        <div class="flex flex-col items-end">
          <form
            th:action="@{'/lineup/' + ${team.id} + '/save'}"
            method="post"
            id="saveForm"
          >
            <input type="hidden" name="starterIds" id="starterIdsInput" />
            <button
              type="submit"
              id="saveButton"
              onclick="prepareSubmit()"
              class="disabled:opacity-30 disabled:cursor-not-allowed bg-blue-600 hover:bg-blue-500 text-white font-black px-10 py-4 rounded-full shadow-lg transition-all active:scale-95 uppercase"
              disabled
            >
              Zapisz Sk≈Çad
            </button>
          </form>
          <p
            id="playerCount"
            class="text-right text-xs mt-3 font-bold text-red-500 uppercase tracking-widest animate-pulse"
          >
            Wybierz jeszcze 11 zawodnik√≥w
          </p>
        </div>
      </header>

      <div class="grid grid-cols-2 gap-10">
        <section>
          <h2
            class="text-green-400 font-black mb-4 flex items-center gap-2 uppercase tracking-tight"
          >
            <span
              class="w-3 h-3 bg-green-400 rounded-full shadow-[0_0_10px_#4ade80]"
            ></span>
            Wyj≈õciowy Sk≈Çad (XI)
          </h2>
          <div
            id="starters-zone"
            class="zone bg-slate-900/50 rounded-3xl p-6 border-2 border-slate-800"
            ondragover="allowDrop(event)"
            ondrop="drop(event)"
            ondragleave="removeHighlight(event)"
          >
            <div
              th:each="p : ${starters}"
              th:id="'p-' + ${p.id}"
              th:data-id="${p.id}"
              th:data-injured="${p.injuryDays > 0}"
              class="player-card bg-slate-800 p-4 mb-3 rounded-2xl flex justify-between items-center border border-slate-700 shadow-xl"
              th:classappend="${p.injuryDays > 0 ? 'opacity-50 grayscale border-red-900/50' : ''}"
              draggable="true"
              ondragstart="drag(event)"
            >
              <div class="flex items-center gap-4">
                <div
                  class="ovr-circle w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center font-black text-sm"
                  th:text="${p.overall}"
                ></div>
                <div>
                  <p class="player-name font-bold leading-none text-white">
                    <span th:text="${p.lastName}"></span>
                    <span
                      th:if="${p.injuryDays > 0}"
                      class="ml-2 text-red-500 text-[10px] animate-pulse"
                      >üöë</span
                    >
                  </p>

                  <p
                    th:if="${p.injuryDays == 0}"
                    class="text-[10px] text-slate-500 uppercase mt-1"
                    th:text="'Atk: ' + ${p.offensiveStats} + ' Def: ' + ${p.defensiveStats}"
                  ></p>
                  <p
                    th:if="${p.injuryDays > 0}"
                    class="text-[10px] text-red-400 font-bold uppercase mt-1"
                    th:text="'Powr√≥t za: ' + ${p.injuryDays} + ' dni'"
                  ></p>
                </div>

                <div
                  th:if="${p.injuryDays == 0}"
                  class="flex flex-col items-end gap-1 ml-4 min-w-[60px]"
                >
                  <span
                    class="text-[9px] font-mono font-bold"
                    th:text="${p.stamina + '%'}"
                    th:classappend="${p.stamina > 70 ? 'text-green-400' : (p.stamina > 30 ? 'text-yellow-500' : 'text-red-500')}"
                  ></span>
                  <div
                    class="w-full bg-slate-950 h-1 rounded-full overflow-hidden border border-white/5"
                  >
                    <div
                      class="h-full transition-all duration-500"
                      th:style="'width: ' + ${p.stamina} + '%;'"
                      th:classappend="${p.stamina > 70 ? 'bg-green-500' : (p.stamina > 30 ? 'bg-yellow-500' : 'bg-red-500')}"
                    ></div>
                  </div>
                </div>
              </div>
              <div
                class="badge text-green-500 font-black uppercase"
                th:text="${p.injuryDays > 0 ? 'OUT' : 'XI'}"
              >
                XI
              </div>
            </div>
          </div>
        </section>

        <section>
          <h2
            class="text-slate-500 font-black mb-4 uppercase tracking-tight ml-2"
          >
            ≈Åawka Rezerwowych
          </h2>
          <div
            id="reserves-zone"
            class="zone bg-slate-900/50 rounded-3xl p-6 border-2 border-slate-800"
            ondragover="allowDrop(event)"
            ondrop="drop(event)"
            ondragleave="removeHighlight(event)"
          >
            <div
              th:each="p : ${reserves}"
              th:id="'p-' + ${p.id}"
              th:data-id="${p.id}"
              class="player-card bg-slate-900 p-4 mb-3 rounded-2xl flex justify-between items-center border border-slate-800 opacity-70"
              draggable="true"
              ondragstart="drag(event)"
            >
              <div class="flex items-center gap-4">
                <div
                  class="ovr-circle w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center font-black text-sm text-slate-400"
                  th:text="${p.overall}"
                ></div>
                <div>
                  <p
                    class="player-name font-bold leading-none text-slate-400"
                    th:text="${p.lastName}"
                  ></p>
                  <p class="text-[10px] text-slate-600 uppercase mt-1">
                    REZERWA
                  </p>
                </div>
              </div>
              <div class="flex flex-col items-end gap-1 ml-4 min-w-[60px]">
                <span
                  class="text-[9px] font-mono font-bold"
                  th:text="${p.stamina + '%'}"
                  th:classappend="${p.stamina > 70 ? 'text-green-400' : (p.stamina > 30 ? 'text-yellow-500' : 'text-red-500')}"
                >
                  100%
                </span>
                <div
                  class="w-full bg-slate-950 h-1 rounded-full overflow-hidden border border-white/5"
                >
                  <div
                    class="h-full transition-all duration-500"
                    th:style="'width: ' + ${p.stamina} + '%;'"
                    th:classappend="${p.stamina > 70 ? 'bg-green-500' : (p.stamina > 30 ? 'bg-yellow-500' : 'bg-red-500')}"
                  ></div>
                </div>
              </div>
              <div class="badge text-slate-700 font-black uppercase">SUB</div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script th:src="@{/tactics.js}"></script>
  </body>
</html>
