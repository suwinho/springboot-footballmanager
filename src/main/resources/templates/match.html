<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Match Live - FIFA 16 Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .lineup-container {
        scrollbar-width: none;
      }
      .lineup-container::-webkit-scrollbar {
        display: none;
      }
      .player-row {
        transition: all 0.3s ease;
      }
      .sub-label {
        font-size: 0.6rem;
        letter-spacing: 0.1em;
      }
      @keyframes goal-flash {
        0% {
          background-color: rgba(34, 197, 94, 0);
        }
        50% {
          background-color: rgba(34, 197, 94, 0.4);
        }
        100% {
          background-color: rgba(34, 197, 94, 0);
        }
      }
      .flash-goal {
        animation: goal-flash 1s ease-out;
      }
    </style>
  </head>
  <body class="bg-slate-900 text-white font-sans overflow-hidden">
    <div class="container mx-auto p-6 max-w-5xl">
      <div
        id="scoreboard"
        class="bg-blue-100 text-slate-900 p-6 rounded-t-lg flex justify-between items-center shadow-2xl border-b-4 border-blue-300"
      >
        <div
          class="text-2xl font-black uppercase tracking-tighter w-1/3"
          th:text="${homeTeam.name}"
        >
          HOME
        </div>
        <div
          class="text-5xl font-mono bg-slate-800 text-white px-8 py-2 rounded shadow-inner border-2 border-slate-600 flex justify-center items-center gap-4"
        >
          <span id="homeScore">0</span>
          <span class="text-2xl opacity-50">-</span>
          <span id="awayScore">0</span>
        </div>
        <div
          class="text-2xl font-black uppercase tracking-tighter text-right w-1/3"
          th:text="${awayTeam.name}"
        >
          AWAY
        </div>
      </div>

      <div
        class="grid grid-cols-3 gap-0 bg-blue-50/95 text-slate-800 shadow-xl overflow-hidden rounded-b-lg"
      >
        <div
          class="p-4 border-r border-blue-200 lineup-container h-[550px] overflow-y-auto"
        >
          <h3
            class="text-[10px] font-black text-blue-900/40 uppercase mb-3 tracking-widest"
          >
            Starting XI
          </h3>
          <div id="homeStarters" class="mb-6">
            <div
              th:each="p : ${homePlayers}"
              th:if="${p.isInFirstEleven}"
              th:id="'player-' + ${p.lastName}"
              class="player-row flex justify-between items-center mb-1 border-b border-blue-100 pb-1"
            >
              <span class="font-bold text-xs" th:text="${p.lastName}"></span>
              <span class="card-slot flex gap-1"></span>
            </div>
          </div>
          <h3
            class="text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest"
          >
            Substitutes
          </h3>
          <div id="homeSubs">
            <div
              th:each="p : ${homePlayers}"
              th:if="${!p.isInFirstEleven}"
              th:id="'player-' + ${p.lastName}"
              class="flex justify-between items-center mb-1 text-[10px] opacity-50 border-b border-transparent pb-1"
            >
              <span th:text="${p.lastName}"></span>
              <span class="card-slot flex gap-1"></span>
            </div>
          </div>
        </div>

        <div
          class="p-4 flex flex-col items-center bg-white/50 backdrop-blur-sm"
        >
          <div
            class="text-center font-black text-4xl mb-6 text-blue-900 italic tracking-tighter"
          >
            <span id="matchMinute">0</span
            ><span class="text-xl inline-block ml-1">'</span>
          </div>
          <div
            class="w-full space-y-3 overflow-y-auto h-[450px] pr-2 lineup-container"
            id="matchLog"
          ></div>
        </div>

        <div
          class="p-4 border-l border-blue-200 lineup-container h-[550px] overflow-y-auto text-right"
        >
          <h3
            class="text-[10px] font-black text-blue-900/40 uppercase mb-3 tracking-widest text-right"
          >
            Starting XI
          </h3>
          <div id="awayStarters" class="mb-6">
            <div
              th:each="p : ${awayPlayers}"
              th:if="${p.isInFirstEleven}"
              th:id="'player-' + ${p.lastName}"
              class="player-row flex justify-between items-center flex-row-reverse mb-1 border-b border-blue-100 pb-1"
            >
              <span class="font-bold text-xs" th:text="${p.lastName}"></span>
              <span class="card-slot flex gap-1"></span>
            </div>
          </div>
          <h3
            class="text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest text-right"
          >
            Substitutes
          </h3>
          <div id="awaySubs">
            <div
              th:each="p : ${awayPlayers}"
              th:if="${!p.isInFirstEleven}"
              th:id="'player-' + ${p.lastName}"
              class="flex justify-between items-center flex-row-reverse mb-1 text-[10px] opacity-50 border-b border-transparent pb-1"
            >
              <span th:text="${p.lastName}"></span>
              <span class="card-slot flex gap-1"></span>
            </div>
          </div>
        </div>
      </div>

      <button
        onclick="startMatch()"
        id="startBtn"
        class="w-full bg-blue-600 p-5 mt-6 font-black text-xl hover:bg-blue-500 rounded-lg shadow-lg transform transition active:scale-95 uppercase tracking-widest"
      >
        Kick Off
      </button>
    </div>

    <script th:inline="javascript">
      const events = [[${matchEvents}]];
      const homeName = [[${homeTeam.name}]];
      let currentMin = 0;
      let homeScore = 0;
      let awayScore = 0;

      function addIconToPlayer(playerName, iconEmoji) {
          const playerEl = document.getElementById('player-' + playerName);
          if (playerEl) {
              const slot = playerEl.querySelector('.card-slot');
              if (slot) {
                  const span = document.createElement('span');
                  span.className = "animate-bounce inline-block";
                  span.innerText = iconEmoji;
                  slot.appendChild(span);
                  playerEl.style.opacity = "1";
              }
          }
      }

      function startMatch() {
          document.getElementById('startBtn').style.display = 'none';
          const interval = setInterval(() => {
              currentMin++;
              if(currentMin <= 90) document.getElementById('matchMinute').innerText = currentMin;

              const currentEvents = events.filter(e => e.minute === currentMin);
              currentEvents.forEach(e => {
                  const log = document.getElementById('matchLog');
                  const div = document.createElement('div');
                  div.className = "p-3 bg-white rounded-lg border-l-4 shadow-sm text-[11px] animate-in fade-in slide-in-from-top-2 duration-500 border-blue-800";

                  let icon = "‚öΩ";

                  if(e.type === 'GOAL') {
                      if(e.teamName === homeName) homeScore++;
                      else awayScore++;
                      document.getElementById('homeScore').innerText = homeScore;
                      document.getElementById('awayScore').innerText = awayScore;
                      div.className = div.className.replace('border-blue-800', 'border-green-500 bg-green-50');
                      addIconToPlayer(e.playerName, "‚öΩ");

                      // Efekt b≈Çysku na tablicy
                      const sb = document.getElementById('scoreboard');
                      sb.classList.add('flash-goal');
                      setTimeout(() => sb.classList.remove('flash-goal'), 1000);
                  }

                  if(e.type === 'YELLOW_CARD') {
                      icon = "üü®";
                      div.className = div.className.replace('border-blue-800', 'border-yellow-500 bg-yellow-50');
                      addIconToPlayer(e.playerName, "üü®");
                  }

                  if(e.type === 'SAVE') icon = "üß§";
                  if(e.type === 'MISS') icon = "‚ùå";

                  div.innerHTML = `
                      <div class="flex justify-between font-black text-blue-900 mb-1 italic">
                          <span>${e.minute}'</span>
                          <span class="uppercase tracking-tighter">${e.teamName}</span>
                      </div>
                      <div class="flex items-center gap-2 text-slate-700">
                          <span class="text-base">${icon}</span>
                          <span><strong>${e.playerName}</strong>: ${e.description}</span>
                      </div>
                  `;
                  log.prepend(div);
              });

              if (currentMin >= 90) {
                  clearInterval(interval);
                  document.getElementById('matchMinute').innerText = "FT";
              }
          }, 150);
      }
    </script>
  </body>
</html>
